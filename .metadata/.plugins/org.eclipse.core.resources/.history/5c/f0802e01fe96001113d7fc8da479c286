<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx"
			   width="125"  height="644"
			   x="0" y="60"
			   creationComplete="titlewindow1_creationCompleteHandler(event)">
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	
	<fx:Script>
		<![CDATA[
			import character.Character;
			
			import hud.HudAttribute;
			
			import mx.collections.ArrayList;
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			
			import pkgParty.CharacterDblClickedEvent;
			import pkgParty.CharacterSelectedEvent;
			import pkgParty.Party;
			import pkgParty.ViewEachCharInParty;
			
			import spark.components.Label;
			import spark.filters.DropShadowFilter;
			
			import views.CharacterView;
			
			[Bindable]
			public var aParty: Party;
			
			[Bindable]
			public var character_view:CharacterView;

			private function handleCloseEvent():void{
				visible =false;
			}
			
			private function updateSelectedView(oldIndex:int, newIndex:int):void{
				
				if (oldIndex == newIndex) return; // Don't do anything if you click on the same item again
				aParty.currCharIndex = newIndex;
				var newSelectedElement:ViewEachCharInParty = this.getElementAt(newIndex) as ViewEachCharInParty;
				
				var filter : DropShadowFilter = new DropShadowFilter();
				filter.blurX = 4;
				filter.blurY = 4;
				filter.quality = 2;
				filter.alpha = 0.5;
				filter.angle = 0;
				filter.color = 0x00FFFF;
				filter.distance = 6;
				filter.inner = false;
				
				newSelectedElement.filters= [filter];
				
				if(oldIndex != -1){
					var oldSelectedElement:ViewEachCharInParty = this.getElementAt(oldIndex) as ViewEachCharInParty;
					oldSelectedElement.filters= [];
				}

			}
			
			private function handleCharacterSelected(event:CharacterSelectedEvent):void {
				//Alert.show(event.char.name.value as String);
				aParty.currChar = event.char;
				
				var old_index:int= aParty.currCharIndex;
				//aParty.currCharIndex = event.indexCharInParty;
				//Alert.show(aParty.currChar.name.value as String);
				
				updateSelectedView(old_index,event.indexCharInParty);
				
			}
			
			public function handleCharacterDblClicked(event:CharacterDblClickedEvent):void {
				if (character_view == null){							
					character_view= PopUpManager.createPopUp(this, CharacterView,false) as CharacterView;
					character_view.char = aParty.currChar;	
					character_view.party = this.aParty;
				}
				else{					
					if (character_view.visible == false){
						character_view.visible = true;
					}
					else{
						character_view.visible = false;
					}
				}
				
				
			}

			protected function titlewindow1_creationCompleteHandler(event:FlexEvent):void
			{
				if (aParty == null) return;
				var currPop:int = aParty.currPopulation;
				var i:int;
				
				addEventListener("CharacterIsSelected",handleCharacterSelected);		
				addEventListener("CharacterIsDblClicked",handleCharacterDblClicked);		

				

				for(i=0; i<currPop; i++){
					var viewAChar:ViewEachCharInParty = new ViewEachCharInParty();
					viewAChar.char = aParty.arr_chars.getItemAt(i) as Character;
					viewAChar.updateStatusBar();
										
					viewAChar.index_in_partyview = i;
				
					this.addElement(viewAChar);
				}
				
				updateSelectedView(-1,0);
				
			}
			
		]]>
	</fx:Script>
	
	
	<s:layout>
		<s:VerticalLayout horizontalAlign="center"
						  gap="30"/>
	</s:layout>
	
</s:Group>
