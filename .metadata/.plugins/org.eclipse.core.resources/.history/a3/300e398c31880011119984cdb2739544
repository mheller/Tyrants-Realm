<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx" minWidth="955" minHeight="600"
			   xmlns:hud = "hud.*"
			   xmlns:pkgInventory="pkgInventory.*"
			   xmlns:dungeon="dungeon.*"
			   width="900" height="600"		   
			   creationComplete="creationCompleteHandler(event)"
			   backgroundColor="#000000"
			   >
	<fx:Declarations>
		
	</fx:Declarations>

	<fx:Script>
		<![CDATA[
			import character.*;
			import dungeon.*;
			
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			import mx.managers.SystemManager;
			
			import pkgInventory.Item;
			
			import pkgParty.CharacterSelectedEvent;
			import pkgParty.Party;
			
			import spark.components.TitleWindow;
			
			import views.CharacterView;
			
			[Bindable] //do really need
			public var currChar:Character;// = new Character("Jane Doe","female",100,0,1);
			
			[Bindable]
			public var party1:Party = new Party("myParty",10);
						
			[Bindable]
			public var map:Map;
			
//			[Bindable]
//			public var dungeon3D:Dungeon_6; 
					
			// Hardcoded demo party
			[Bindable]
			public var char2:Character = new Character("Jane","Female","Defender",50, 100, 0, 100, 1, 0, 0, 0, 0, 10, 5, 5, 8, 9, 20, 25, 0, 1, "Fists", 0,0, 0,0,0,0, 1,0, "assets/Female/Body.jpg", "assets/Female/Head - Black.png");
			[Bindable]
			public var char3:Character = new Character("Jill","Female", "Elementalist", 100, 100, 0, 100, 1, 100, 100, 0, 0, 5, 10, 9, 6, 5, 15, 35, 0, 1, "Fists", 1, 2, 0,0,0,0, 2,0, "assets/Female/Body.jpg", "assets/Female/Head - Blonde.png");
			[Bindable]
			public var char4:Character = new Character("Jack","Male", "Hand of Grace", 100, 100, 0, 100, 1, 100, 100, 0, 0, 5,8, 10, 5, 8, 15, 30, 0, 1, "Fists", 1,1, 0,0,0,0, 3,0,"assets/Male/Body.jpg", "assets/Male/Head - Black.png");
			[Bindable]
			public var char5:Character = new Character("Julia","Female", "Tempus Diem Fur", 100, 100, 0, 100, 1, 8, 10, 0, 0, 6, 5, 5, 10, 10, 15, 35, 0, 1, "Fists", 0,0, 0,0,0,0, 4,0,"assets/Female/Body.jpg", "assets/Female/Head - Red.png");
	
/*			public function Character(name:String,gender:String, character_class:String="N/A",  
											health_current:int=100, health_max:int=100, total_experience:int=0,experience_to_level:int=100,level:int=1, 
											spirae_current:int=0, spirae_max:int=0, denarii:int=0, stater:int=0,																						 
											fitness:int=0,mental_prowess:int=0, spirituality:int=0, eloquence:int=0, coordination:int=0,																											 
											hit:int=0, avoidance:int=0, damage_min:int=0, damage_max:int=0, damage_type:String="Fists",
											magic_dmg_min:int=0, magic_dmg_max:int=0,
											damage_resistance:int=0,cold_resistance:int=0, heat_resistance:int=0, magic_resistance:int=0, 
											party_position:int=0, career_changes:int=0, appearance_basebody:String, appearance_basehead:String, appearance_weapon:String,
			                                appearance_offhand:String, appearance_torso:String, appearance_head:String, appearance_legs:String, appearance_feet:String,
			                                appearance_shoulders:String, appearance_hands:String)

*/
			
			protected function creationCompleteHandler(event:FlexEvent):void
			{				
				
				party1.addChar(char2);
				party1.addChar(char3);
				party1.addChar(char4);
				party1.addChar(char5);
				
				party1.currChar = party1.arr_chars.getItemAt(0) as Character;
				this.currChar = party1.currChar;
				
				addEventListener("finishedLoadingMapXML", start3D);//later, will do this one in Preloader
				map = new Map();	
				view.addElement(map);
				

			}		
			
			public function start3D(e:Event):void{
				//trace(map);
//				dungeon3D =  new Dungeon_6(map);
//				addElement(dungeon3D);
				dungeon3D.init();
				//this.setFocus();
				//this.systemManager.addEventListener("CharacterIsSelected",handleCharacterSelected);
				
			}
			
//			private function handleCharacterSelected(event:CharacterSelectedEvent):void {
//				//Alert.show(event.char.name.value as String);
//				//Alert.show("Event change character");
//				//this.currChar = party1.currChar;
//			}
					
		]]>
	</fx:Script>
	<s:layout>
		<s:VerticalLayout verticalAlign="middle" horizontalAlign="center"/>
	</s:layout>
	
	<s:Group id="view" width="900" height="600">
		<dungeon:Dungeon_6 id="dungeon3D" width="100%" height = "100%"
						  
						   map="{this.map}"/>
		<s:Group depth="1" bottom="20" left="600">
			<s:Rect width = "100%" height="100%">
				<s:fill>
					<s:SolidColor color="0x666666" />
				</s:fill>
			</s:Rect>
			
			<s:HGroup>
				<hud:HudAttribute char="{this.currChar}" party="{this.party1}"/>
				
				<!--			<hud:HudInventory inventory="{currChar.inventory}" width="100%" height="100%"/>
				-->
				<hud:HudChat width="100%" height="100%"/>
				<hud:HudMap width="100%" height="100%"
							map="{map}"
							dungeon3D="{dungeon3D}"/>
				<hud:HudParty width="100%" height="100%" aParty="{this.party1}"/>		
			</s:HGroup>
			
		</s:Group>	
	</s:Group>
	
	
	
</s:Application>